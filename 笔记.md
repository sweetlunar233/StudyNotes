# MySQL

## 其他基本知识

> 这里的知识又杂又乱，类似于一本工具书，建议学到后面看到不懂的，可以过来查一查



### 字段类型

MySQL中的数据类型很多，主要分为三类：**数值类型**，**字符串类型**，**日期时间类型**

#### 数值类型

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\数值类型.png)

> 1. 要使用无符号的数值类型，要在字段类型**后**加上`unsigned`具体如下：
>
> ``` sql
> create table balabal(
> 	id int unsigned
> );
> ```
>
> 2. 对于浮点数，要用 `浮点数类型(M,D)`来使用，其中M表示这个浮点数可以有多长（整数位 + 小数位），D表示小数有多少位。比如：
>
> ``` sql
> double (4,1) //可以用来表示 85.2 , 100.0
> ```

#### 字符串类型

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\字符串类型.png)

> 详细说一下`char` 和`varchar`
>
> 1. 使用时应该为`char(M)`或者`varchar(M)`，`M`代表这个字符串最多有多少个字符。
> 2. 二者不同点：
>    * 存储空间不同：
>      * 如果使用了`char(10)`但只存储了 1 个字符，则仍占用 10 个字符的空间，除去存储字符，其他空间都补上空格。
>      * 如果使用`varchar(10)`但只存储了 1 个字符，则只占用 1 个字符的空间。
>    * 性能不同：由于`varchar`需要根据存储字符个数决定长度，故`char`性能高，而`varchar`性能较低。

#### 日期时间类型

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\日期.png)

<font color = SlateGray>使用案例：</font>

``` sql
#字段名称 字段类型
birthday date
```



## 数据库有关基本概念

* 数据库
  * 数据存储的仓库
* 数据库管理系统
  * 操纵和管理数据库的大型软件
* SQL
  * 操作关系型数据库的编程语言，是一套标准

> 虽然我们学习的是MySQL数据库，但是SQL是一套不变的操作语言，学到的东西仍可以用于操作其他数据库，比如Oracle什么的



## 基础

### MySQL的启动与停止

* 启动（命令行输入）

``` 命令行
net start mysql80
```

* 停止（命令行输入）

``` 命令行
net stop mysql80
```

❗注意：要以管理员身份运行cmd才可成功（可以在左下角搜索栏搜索cmd然后点击以管理员身份启动）



* **客户端**连接

  * 方法一：MySQL提供的客户端命令行工具

    ![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\客户端连接法1.png)

  * 方法二：系统自带的命令行工具执行指令

    ``` 命令行
    mysql [-h <IP>][-P <端口>] -u root -p //"[]"框内的表示可以省略 "<>" 内的以具体情况替换
    ```

    默认情况下

    ``` 命令行
    mysql [-h 127.0.0.1][-P 3306] -u root -p //"[]"内可省略
    ```

    > 注意，要用这种方法需要配置PATH环境变量（本人已配置）

### 数据模型概念

* 关系型数据库（RDBMS）

  * 概念：建立在关系模型基础上，由多张**相互连接的二维表**组成的数据库

    * 二维表：有行有列

    * 相互连接：类似如下关系

      ![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\相互连接的二维表.png)

  * 特点：

    * 使用表存储数据，格式统一，便于维护
    * 使用SQL语言操作，标准统一，使用方便

### SQL

* 通用语法
  1. SQL可以单行或多行书写，以分号结尾
  2. SQL语句可以使用空格 / 缩进来增强语句的可读性
  3. MySQL数据库的SQL语句不区分大小写，关键字建议使用大写
  4. 注释：
     * 单行注释：`-- 注释内容`或`# 注释内容 `（MySQL特有）
     * 多行注释：`/* 注释内容 */`

* SQL分类

| 分类 |            全程            |                          说明                          |
| :--: | :------------------------: | :----------------------------------------------------: |
| DDL  |  Data Definition Language  |  数据定义语言，用来定义数据库对象( 数据库，表，字段 )  |
| DML  | Data Manipulation Language |      数据操作语言，用来对数据库中的数据进行增删改      |
| DQL  |    Data Query Language     |         数据查询语言，用来查询数据库中表的记录         |
| DCL  |   Data Control Language    | 数据控制语言，用来创建数据库用户、控制数据库的访问权限 |

#### DDL

> 可以大写可以小写，就是不能混合大小写

##### 数据库操作

* 查询

  * 查询所有数据库

  ``` sql
  show databases;
  ```

  * 查询当前数据库

  ``` sql
  select database();
  ```

* 创建

``` sql
create database [if not exists] 数据库名 [default charset 字符集] [collate 排序规则];
# "[if not exists]"：如果不省略，则表示 如果不存在如此名称的数据库，则创建；如果存在同名数据库，则不创建。如果不加这条语句并创建了同名数据库，则报错。
# "[default charset 字符集] [collate 排序规则]":指定数据库的字符集和排序规则，若省略，则表示使用默认的
# 只要输入后返回"Query OK"就表示当前数据库创建成功
```

​	*举例：*
``` sql
create database if not exists mydatabase default charset utf8m64;
```

* 删除

``` sql
drop database [if exists] 数据库名;
#"[if exists]":如果存在，则删除
```

* 使用

``` sql
use 数据库名
# 使用相当于 进入数据库 ，此时再输入 select database(); 则会显示，已经切换到了刚刚 use 的数据库
```

##### 表操作

* 查询

  * 查询当前数据库所有表

  ``` sql
  show tables;
  ```

  * 查询表结构

  ``` sql
  desc 表名;
  ```

  * 查询指定表的建表语句

  ``` sql
  show create table 表名;
  ```

* 创建

``` sql
create table 表名(
	字段1 字段1类型 [comment 字段1注释],
    字段2 字段2类型 [comment 字段2注释],
    ......
    字段n 字段n类型 [comment 字段n注释]
)[comment 表注释];
```

* 修改

  * 添加字段

  ``` sql
  alter table 表名 add 字段名 类型（长度）[comment 注释] [约束]；
  ```

  * 修改字段数据类型
  
  ``` sql
  alter table 表名 modify 字段名 新数据类型(长度)；
  ```
  
  * 修改字段名和数据类型
  
  ``` sql
  alter table 表名 change 旧字段名 新字段名 类型(长度) [comment 注释] [约束]；
  ```
  
  * 删除字段
  
  ``` sql
  alter table 表名 drop 字段名；
  ```
  
  * 修改表名
  
  ``` sql
  alter table 表名 rename to 新表名;
  ```
  
* 删除

  * 删除表（完全删除指定的对象以及与该对象相关的所有数据和定义）

  ``` sql
  drop table [if exists] 表名;
  ```

  * 仅删除表中的数据，但保留表的结构

  ``` sql
  truncate table 表名;
  ```

> `drop table`和`truncate table`的区别：
>
> 1. `drop table`在需要永久删除一个表及其数据时使用。`truncate table`在需要快速删除表中数据但保留表结构时使用。
> 2. 运行速度不同。`drop table`要快于`truncate table`。



#### DML

DML负责：

* 添加数据
* 修改数据
* 删除数据

##### 添加数据

* 给指定字段添加数据

``` sql
insert into 表名 (字段名1，字段名2，......) values(值1，值2，......);
```

* 给全部字段添加数据

``` sql
insert into 表名 values(值1，值2，.....)；
```

* 批量添加数据

``` sql
#给指定字段批量添加数据
insert into 表名 (字段名1，字段名2，...) values(值1，值2，...),(值1，值2，...),....;
```

```sql
#给所有字段批量添加数据
insert into 表名 values(值1，值2，...),(值1，值2，...),....;
```



##### 修改数据

``` sql
update 表名 set 字段名1=值1，字段名2=值2,...[where 条件]；
```

> "[where 条件]" 如果没有，则表示修改整张表

<font color=SlateGray>比如:</font>

<font color=SlateGray>修改`id`为 1 的数据，将`name`修改为`铁柱giegie`</font>

``` sql
update employee set name='铁柱giegie' where id=1;
```

<font color=SlateGray>修改所有的员工入职日期为`2008-01-01`</font>

``` sql
update employee set entrydate = '2008-01-01';
```



##### 删除数据

``` sql
delete from 表名 [where 条件];
```

> 1. 如果没有`where 条件`则删除整张表的所有数据
> 2. `delete`语句不能删除一个字段，只能删除一行。如果想要删除一个字段，可以用`update`语句将某一字段置为`NULL`。

#### DQL

* DQL英文全称是Data Query Language(数据查询语言)，数据查询语言，用来查询数据库中表的记录。

##### 基本语法

``` sql
select
	字段列表
from
	表名列表
where
	条件列表
group by
	分组字段列表
having
	分组后条件列表
order by
	排序字段列表
limit
	分页参数
```

> 你可能看不懂，可以往下看

我们在讲解这部分内容的时候，会将上面的完整语法进行拆分，分为以下几个部分：

* 基本查询（不带任何条件）

* 条件查询（WHERE）

* 聚合函数（count、max、min、avg、sum）

* 分组查询（group by）

* 排序查询（order by）

* 分页查询（limit）

##### 基本查询

> 指不带任何条件的查询

* 查询多个字段

``` sql
#查询指定字段
select 字段1,字段2,字段3,... from 表名;
#查询所有字段
select * from 表名;
```

* 字段设置别名

``` sql
select 字段1 [as 别名1],字段2 [as 别名2] ... from 表名;
select 字段1 [别名1],字段2 [别名2],... from 表名;
```

* 查询多个字段，但不输出重复的字段

``` sql
select distinct 字段列表 from 表名;
```

##### 条件查询

* 语法

``` sql
select 字段列表 from 表名 where 条件；
# 可以用 * 代表所有字段
```

* 条件

常用的比较运算符：

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\比较运算符.png)

常用的逻辑运算符：

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\逻辑运算符.png)

<font color = SlateGray>举例：</font>

<font color = SlateGray>查询有身份证号的员工信息</font>

``` sql
select * from emp where idcard is not null;
```

<font color = SlateGray>查询年龄在15到20之间的员工信息</font>

``` sql
select * from emp where age between 15 and 20;
select * from emp where age >= 15 and age <= 20;
select * from emp where age >= 15 && age <= 20;
```

<font color = SlateGray>查询姓名为两个字的员工</font>

``` sql
select * from emp where name like '__';
```

##### 聚合函数

* 聚合函数：将一列作为一个整体，进行纵向计算。
* 常见聚合函数

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\常见聚合函数.png)

* 语法

``` sql
select 聚合函数(字段列表) from 表名;
```

> ❗ 注意：NULL值不参与所有聚合函数的运算。

<font color = SlateGray>举例</font>

<font color = SlateGray>统计该企业员工数量</font>

``` sql
select count(*) from emp;
```

<font color = SlateGray>统计西安地区员工的年龄之和</font>

``` sql
select sum(age) from emp where workaddress = '西安';
```

##### 分组查询

* 语法

``` sql
select 字段列表，聚合函数(字段) from 表名 [where 条件] group by 分组字段名 [having 分组后过滤条件]
```

> `select`:指明想从表中选择的列（这些选择的列会在执行指令后显示，如果不选择，那就不显示），通常包括一个或多个聚合函数。
>
> `group by`:后跟随一个或多个列，这些列用于数据分组。

* `where`与`having`区别
  * 执行时机不同：`where`是分组之前进行过滤，不满足`where`条件，不参与分组；而`having`是分组之后对结果进行过滤。
  * 判断条件不同：`where`不能对聚合函数进行判断，而`having`可以。

> 注意事项：
>
> 1. 分组之后，查询的字段一般为聚合函数和分组字段，查询其他字段无任何意义
> 2. 执行顺序: `where` > 分组 > 聚合函数 > `having` 。
> 3. 支持多字段分组, 具体语法为 : `group by columnA,columnB`

<font color = SlateGray>举例：</font>

<font color = SlateGray>根据性别分组，统计男性员工和女性员工的数量</font>

``` sql
select gender,count(*) from emp group by gender;
```

<font color = SlateGray>对于年龄小于45的员工，获取员工数量大于等于3的工作地址</font>

``` sql
/* 
分析题目：
1. "对于年龄小于45的员工"是最初始的要求 -> 'where age < 45'
2. 要获取'员工数量大于等于3的工作地址'，肯定要计算每一个工作地址的员工数量。不妨以工作地址分组，分组之后再用聚合函数`count`计算。最后用 having 查询。
*/
select workaddress, count(*) address_count from emp where age < 45 group by workaddress having address_count >= 3;
```

<font color = SlateGray>统计各个工作地址上班的男性及女性员工的数量</font>

``` sql
select workaddress, gender, count(*) from emp group by gender , workaddress;
```

##### 排序查询

* 语法

``` sql
select 字段列表 from 表名 order by 字段1 排序方式1，字段2 排序方式2;
```

* 排序方式：
  * ASC：升序（默认）
  * DESC：降序

>注意：
>
>* 如果是升序，可以不指定排序方式
>* 如果多字段排序，当第一个字段值相同时，才会根据第二个字段进行排序

##### 分页查询

你可以想象一下原神的抽卡记录，一页有五个。分页查询的作用就是把一整个大表分成一页一页的小表。

* 语法

``` sql
select 字段列表 from 表名 limit 起始索引,查询记录数;
```

> * 起始索引：可以理解为，这一页从哪一条数据开始。比如，想查询抽卡记录第一页，起始索引就是 0 ，如果查第二页，起始索引就是 5。
> * 查询记录数：一页显示几个数据。比如，抽卡记录的查询记录数就是 5。
> * 起始索引从 0 开始，起始索引 = （查询页码 -1 ）*每页显示记录数。
> *  如果查询的是第一页数据，起始索引可以省略，直接简写为`limit 查询记录数`。

##### 执行顺序

所谓执行顺序，就是DQL语句在执行时，先执行哪一部分，再执行哪一部分。

``` sql
#语法						  执行顺序
select						from
	字段列表					表名列表
from						where
	表名						 条件列表
where						group by
	条件列表					分组后字段列表
group by					having
	分组字段列表				   分组后过滤条件
having 						select
	分组后条件过滤				   字段列表
order by					order by
	排序字段列表					排序字段列表
limit						limit	
	分页参数					 分页参数
```

验证：
查询年龄大于15的员工姓名、年龄，并根据年龄进行升序排序。

``` sql
select name , age from emp where age > 15 order by age asc;
```

在查询时，我们给`emp`表起一个别名`e`，然后在`select` 及 `where`中使用该别名。

``` sql
select e.name , e.age from emp e where e.age > 15 order by age asc;
```

执行上述SQL语句后，我们看到依然可以正常的查询到结果，此时就说明： `from` 先执行, 然后`where`和`select`执行。那`where`和`select`到底哪个先执行呢?

此时，此时我们可以给`select`后面的字段起别名，然后在`where`中使用这个别名，然后看看是否可以执行成功。

``` sql
select e.name ename , e.age eage from emp e where eage > 15 order by age asc;
```

执行上述SQL报错了。

由此我们可以得出结论: `from`先执行，然后执行`where`， 再执行`select`。

接下来，我们再执行如下SQL语句，查看执行效果：

``` sql
select e.name ename , e.age eage from emp e where e.age > 15 order by eage asc;
```

结果执行成功。 那么也就验证了: `order by`是在`select`语句之后执行的。

综上：得证。

#### DCL

DCL英文全称是Data Control Language(数据控制语言)，用来管理数据库用户、控制数据库的访问权限。

##### 管理用户

* 查询用户

``` sql
select * from mysql.user;
```

查询结果：

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\查询用户结果.png)

其中`Host`代表当前用户访问的主机, 如果为`localhost`, 仅代表只能够在当前本机访问，是不可以远程访问的。`User`代表的是访问该数据库的用户名。在MySQL中需要通过`Host`和`User`来唯一标识一个用户。

* 创建用户

``` sql
create user '用户名'@'主机名' identified by '密码'；
```

* 修改用户密码

``` sql
alter user '用户名'@'主机名' identified with mysql_native_password by '新密码';
```

* 删除用户

``` sql
drop user '用户名'@'主机名';
```

>* 在MySQL中需要用`用户名@主机名`唯一标识一个用户。
>* 主机名可以用`%`适配

<font color=SlateGray>举例</font>

<font color=SlateGray>创建用户`heima`, 可以在任意主机访问该数据库, 密码`123456`;</font>

``` sql
create user 'heima'@'%' identified by '123456';
```

#### 权限控制

MySQL中定义了很多种权限，但是常用的就以下几种：

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\常用权限.png)

* 查询权限

``` sql
show grants for '用户名'@'主机名'；
```

* 授予权限

``` sql
grant 权限列表 on 数据库名.表名 to '用户名'@'主机名';
```

* 撤销权限

``` sql
revoke 权限列表 on 数据库名.表名 from '用户名'@'主机名';
```

> * 多个权限之间，用逗号分割
> * 授权时，数据库名和表名可以使用 `*` 通配，代表所有

### 函数

MySQL中的函数主要分为以下四类：

1.  字符串函数
2. 数值函数
3. 日期函数
4. 流程函数

#### 字符串函数

常用字符串函数如下：

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\常用字符串函数.png)

> `lpad`和`rpad`所述的 "达到n个字符串长度" 指的是填充后的`str`达到n的长度

<font color=SlateGray>举例：</font>

<font color=SlateGray>由于业务需求变更，企业员工的工号，统一为5位数，目前不足5位数的全部在前面补0</font>

``` sql
update emp set workno = lpad(workno,5,'0');
```

#### 数值函数

常见数值函数如下：

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\常见数值函数.png)

<font color=SlateGray>举例</font>

<font color=SlateGray>通过数据库的函数，生成一个六位数的随机验证码</font>

``` sql
#思路：首先可以通过`rand()`生成随机数，但这个随机数只介于0-1，所以要乘上1000000。明显，乘上1000000后，还是一个小数，可以通过`round（）`四舍五入（其他方式也可）。但这个数还是可能不到6位。最后用`lpad（）`补齐即可
select lpad(round(rand()*1000000),6,'0');
```

#### 日期函数

常用日期函数如下：

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\常用日期函数.png)

> 上表中描述的`datediff`有一点歧义。`datediff(date1,date2)`的功能为，返回 `date1` - `date2`（的天数）

<font color=SlateGray>举例：</font>

<font color=SlateGray>查询所有员工的入职天数，并根据入职天数倒序排序。</font>

``` sql
select name,datediff(curdate(),entrydate) as 'entrydays' order by enrtydays desc;
```

#### 流程函数

流程函数也是很常用的一类函数，可以在SQL语句中实现条件筛选，从而提高语句的效率。

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\流程函数.png)

<font color=SlateGray>查询 emp 表的员工姓名和工作地址 (北京/上海 ----> 一线城市 , 其他 ----> 二线城市)</font>

``` sql
select name,(case workaddress when '北京' then '一线城市' when '上海' then '一线城市' else '二线城市' end) from emp;
```

### 约束

#### 概述

概念：约束是作用于表中字段上的规则，用于限制存储在表中的数据

目的：保证数据库中数据的正确、有效性和完整性。

分类：

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\约束分类.png)

> 约束是作用于表中字段上的，可以在创建表/修改表的时候添加约束。

#### 使用方法

只需在字段后加上约束的关键字即可

<font color=SlateGray>案例: 根据如下需求，完成表结构的创建</font>

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\约束演示.png)

对应建表语句如下：

``` sql
create table tb_user(
    id int primary key auto_increment comment 'ID唯一标识',
    name varchar(10) unique not null comment '姓名',
    age int check(age>0 && age<=120) comment '年龄',
    status char(1) default '1' comment '状态',
    gender char(1) comment '性别'
);
```

#### 外键约束

##### 介绍

> 外键：用来让两张表的数据之间建立连接，从而保证数据的一致性和完整性。

##### 语法

* 添加外键

``` sql
create table 表名(
	字段名 数据类型,
    ...
    [constraint] [外键名称] foreign key (外键字段名) references 主表(主表列名)
);
```

```sql
alter table 表名 add constraint 外键名称 foreign key (外键字段名) references 主表(主表列名);
```

> * 外键字段名：该表中要建立连接的字段
>
> * 主表：要产生关联的表
> * 主表列名：该外键字段要和主表的哪一列产生关联

<font color=SlateGray>为`emp`表的`dept_id`字段添加外键约束,关联`dept`表的主键id。</font>

<font color=SlateGray>(`dept_id`表示某员工的部门，`dept`表中则存放着部门的信息)</font>

```sql
alter table emp add constraint fk_emp_dept_id foreign key (dept_id) references dept(id);
```

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\外键案例.png)

* 删除外键

``` sql
alter table 表名 drop foreign key 外键名称;
```

##### 删除/更新行为

添加了外键之后，再删除父表数据时产生的约束行为，我们就称为删除/更新行为。具体的删除/更新行为有以下几种:

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\删除更新行为.png)

具体语法演示：
由于`NO ACTION`是默认行为（即，如果不加任何修饰，则不允许删除/更新主表）就不再演示了，这里我们再演示其他的两种行为：`CASCADE`、`SET NULL`。

* `cascade`

``` sql
alter table 表名 add constraint 外键名称 foreign key (外键字段) references 主表(主表列名) on update cascade on delete cascade;
```

* `set null`

``` sql
alter table 表名 add constraint 外键名称 foreign key (外键字段) references 主表(主表列名) on update set null on delete set null;
```

### 多表查询

我们之前在讲解SQL语句的时候，讲解了DQL语句，也就是数据查询语句，但是之前讲解的查询都是单表查询，而本章节我们要学习的则是多表查询操作。

#### 多表关系

1. 一对多（多对一）
2. 多对多
3. 一对一

##### 一对多

案例：部门与员工的关系。一个部门对应多个员工，一个员工对应一个部门。

实现：在 多 的一方建立外键，指向 一 的一方。

##### 多对多

案例：学生与课程的关系。一个学生可以选修多门课程，一门课程也可以供多个学生选择。

实现： 建立第三张中间表，中间表至少包含两个外键，分别关联两方主键

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\多对多.png)

##### 一对一

案例：用户 与 用户详情 的关系。

关系：一对一关系，多用于单表拆分，将一张表的基础字段放在一张表中，其他详情字段放在另一张表中，以提升操作效率

实现：在任意一方加入外键，关联另外一方的主键，并且设置外键为唯一的(`UNIQUE`)

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\一对一案例.png)

#### 多表查询

##### 概述

多表查询就是指从多张表中查询数据。

之前的查询都是单表查询（`select * from emp`）

如果要查询多表则：

``` sql
select * from 表1,表2,.....;
```

❗注意：查询结果是多个表的笛卡尔积

<font color=SlateGray>比如：执行` select * from emp,dept`，具体执行结果如下：</font>

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\多表查询笛卡尔积.png)

<font color=SlateGray>此时,我们看到查询结果中包含了大量的结果集，总共102条记录，而这其实就是员工表`emp`所有的记录(17) 与 部门表`dept`所有记录(6) 的所有组合情况，这种现象称之为笛卡尔积。</font>

如何去除无效笛卡尔积？（比如，一行中只显示一个员工的信息和这个员工对应的部门信息）

只需要给多表查询加上连接查询的条件即可：

<font color = Gray>（连接查询下一节就会学到）</font>

``` sql
select * from emp,dept where emp.dept_id = dept.id;
```

##### 分类

* 连接查询
  * 内连接：相当于查询A、B交集部分数据
  * 外连接：
  * 左外连接：查询左表所有数据，以及两张表交集部分数据
  * 右外连接：查询右表所有数据，以及两张表交集部分数据
  * 自连接：当前表与自身的连接查询，自连接**必须使用表别名**

* 子查询

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\子查询.png)

#### 内连接

内连接查询的是上图中的绿色部分（两张表交集部分）

内连接的语法分为两种: 隐式内连接、显式内连接。

* 隐式内连接

``` sql
select 字段列表 from 表1,表2... where 条件...; 
```

* 显式内连接

``` sql
select 字段列表 from 表1 [inner] join 表2 on 连接条件...;
```

#### 外连接

外连接分为两种，分别是：左外连接 和 右外连接。

* 左外连接: 左外连接相当于查询表1(左表)的所有数据，当然也包含表1和表2交集部分的数据。

``` sql
select 字段列表 from 表1 left [outer] join 表2 on 条件...;
```

* 右外连接: 右外连接相当于查询表2(右表)的所有数据，当然也包含表1和表2交集部分的数据。

``` sql
select 字段列表 from 表1 right [outer] join 表2 on 条件...;
```

#### 自连接

##### 自连接查询

自连接查询，顾名思义，就是自己连接自己，也就是把一张表连接查询多次。我们先来学习一下自连接的查询语法：

``` sql
select 字段列表 from 表A 别名A join 表A 别名b on 条件...;
select 字段列表 from 表A 别名A,表A 别名b where 条件...;
```

<font color = SlateGray>举例：查询员工及其所属领导的名字</font>

``` sql
select a.*,b.name from emp a,emp b where a.managerid = b.id;
```

##### 联合查询

对于union查询，就是把多次查询的结果合并起来，形成一个新的查询结果集。

``` sql
select 字段列表 from 表A...
union [all]
select 字段列表 from 表B...;
```

* 对于联合查询的多张表的列数必须保持一致，字段类型也需要保持一致。
* union all 会将全部的数据直接合并在一起，union 会对合并之后的数据去重

#### 子查询

##### 概述

* 概念：SQL语句中嵌套select语句，称为嵌套查询，又称子查询。

``` sql
select * from t1 where column1 = (select column1 from t2);
```

子查询外部的语句可以是insert / update / delete/ select 的任何一个。

* 分类：

  根据子查询结果不同，分为

  * 标量子查询（子查询结果为单个值）
  * 列子查询(子查询结果为一列)
  * 行子查询(子查询结果为一行)
  * 表子查询(子查询结果为多行多列)

   根据子查询位置，分为

  * WHERE之后
  * FROM之后
  * SELECT之后

##### 标量子查询

子查询返回的结果是单个值（数字、字符串、日期等），最简单的形式，这种子查询称为标量子查询。

常用的操作符：''=''  ''<>''  ''>''  ''>=''  ''<''  ''<='' 

<font color=SlateGray>举例：查询 "销售部" 的所有员工信息</font>

<font color=Lighblue>完成这个需求时，我们可以将需求分解为两步：</font>

<font color=Lighblue>1. 查询"销售部"的id</font>

``` sql
select id from dept where name='销售部';
```

<font color=Lighblue>2. 根据"销售部"的id，查询员工信息</font>

``` sql
select * from emp where dept_id = (select id from dept where name = '销售部');
```

##### 列子查询

子查询返回的结果是一列（可以是多行），这种子查询称为列子查询。

常用的操作符：IN 、NOT IN 、 ANY 、SOME 、 ALL

![](D:\我下的东西在这里呀\文件会在这里吗\程序员学习\MySQL\图片\列子查询.png)

<font color = SlateGray>举例：查询比 财务部 所有人工资都高的员工信息</font>

``` sql
select * from emp where salary > all(select salary from emp where dept_id = (select id from dept where name = '财务部'));
```

<font color = SlateGray>查询比研发部其中任意一人工资高的员工信息</font>

``` sql
select * from emp where salary > any(select salary from emp where dept_id = (select id from dept where name = '研发部'));
```

##### 行子查询

子查询返回的结果是一行（可以是多列），这种子查询称为行子查询。

常用的操作符：''='' 、''<>'' 、''IN'' 、''NOT IN''

<font color=SlateGray> 查询与 "张无忌" 的薪资及直属领导相同的员工信息 </font>

<font color=ligblue>1. 查询"张无忌" 的薪资及直属领导</font>

``` sql
select salary,managerid from emp where name = '张无忌';
```

<font color = ligblue>2. 查询与 "张无忌" 的薪资及直属领导相同的员工信息</font>

``` sql
select * from emp where (salary,managerid) = (select salary,managerid from emp where name = '张无忌');
```

##### 表子查询

子查询返回的结果是多行多列，这种子查询称为表子查询。

常用的操作符：IN

<font color = SlateGray>查询与 "鹿杖客" , "宋远桥" 的职位和薪资相同的员工信息</font>

``` sql
select * from emp where (job,salary) in (select job,salary from emp where name = '鹿杖客' or name = '宋远桥');
```

### 事务

#### 简介

事务 是一组操作的集合，它是一个不可分割的工作单位，事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。

<font color=SlateGray>比如: 张三给李四转账1000块钱，张三银行账户的钱减少1000，而李四银行账户的钱要增加1000。 这一组操作就必须在一个事务的范围内，要么都成功，要么都失败。</font>

<font color=SlateGray>异常情况: 转账这个操作, 也是分为以下这么三步来完成 , 在执行第三步是报错了, 这样就导致张三减少1000块钱, 而李四的金额没变, 这样就造成了数据的不一致, 就出现问题了。</font>

为了解决上述的问题，就需要通过数据的事务来完成，我们只需要在业务逻辑执行之前开启事务，执行完毕后提交事务。如果执行过程中报错，则回滚事务，把数据恢复到事务开始之前的状态。

步骤

1. 开启事务
2. 如果正常执行完毕，则提交事务
3. 如果执行过程中报错，则回滚事务
